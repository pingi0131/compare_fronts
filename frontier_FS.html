<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>Frontier detail Information</title>
    <link rel="stylesheet" href="css/frontier_FS.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>

    <!-- <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@2.2.2/dist/chartjs-plugin-dragdata.min.js">
    </script> -->
    <script>
        // 偵測是否為舊瀏覽器（缺少 ES6 關鍵功能）
        if (!window.Promise || !Array.prototype.find) {
            var s = document.createElement('script');
            s.src = 'https://polyfill.io/v3/polyfill.min.js?features=es6';
            s.defer = true;
            document.head.appendChild(s);
        }
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            chtml: { scale: 1.5 }
        };
    </script>
    
</head>

<body>
    <div class="data-source-container">
        <select id="dataSourceSelect">
            <option value="EPM_H-MoQTS">EPM H-MoQTS</option>
            <option value="WPM_Hybird">WPM Hybrid</option>
            <option value="WPM_MoQTS">WPM MoQTS</option>
            <option value="WPM_MoQA">WPM MoQA</option>
        </select>
    </div>
    <div class="date-inputs">
        <input type="number" id="yearInput" placeholder="Year" min="2020" max="2025" step="1">
        <input type="number" id="periodInput" placeholder="Month" min="1" max="12" step="1">
        <button id="loadDateBtn" class="load-btn">✔️</button>
    </div>
    <div class="period-sidebar" id="periodSidebar">
        <div class="period-entry selected" data-period="M2M">M2M</div>
        <div class="period-entry" data-period="Q2Q">Q2Q</div>
        <div class="period-entry" data-period="H2H">H2H</div>
        <div class="period-entry" data-period="Y2Y">Y2Y</div>
        <!-- <div class="period-entry" data-period="M*">M*</div> -->
    </div>
    
    <div class="sidebar-trigger" id="sidebarTrigger"></div>
    <div class="sidebar" id="dateSidebar">
        <!-- Date entries will be populated by JavaScript -->
    </div>

    <div class="main-content">
        <h1>前緣詳細資料 投資組合&資金水位
        </h1>

        <div class="range-controls">
            <span class="math-label">\( f_1(x) \)</span>
            <input type="number" id="minRisk" placeholder="Min" step="1">
            <button class="reset-range-btn" onclick="resetField('minRisk')"></button>
            <span class="tilde">-</span>
            <input type="number" id="maxRisk" placeholder="Max" step="1">
            <button class="reset-range-btn" onclick="resetField('maxRisk')"></button>
            
            <span class="math-label">\( f_2(x) \)</span>
            <input type="number" id="minProfit" placeholder="Min" step="1">
            <button class="reset-range-btn" onclick="resetField('minProfit')"></button>
            <span class="tilde">-</span>
            <input type="number" id="maxProfit" placeholder="Max" step="1">
            <button class="reset-range-btn" onclick="resetField('maxProfit')"></button>
            
            <button class="reset-allrange-btn" onclick="resetAllRanges()"></button>
        </div>
        <hr style="margin: 20px 0; border: 1px solid #ccc;">
        <div id="fileListContainer" class="controls"></div>
        <!-- <button id="resetColorsBtn" class="reset-btn" onclick="resetColors()" style="display: none;">重置所有顏色</button> -->
        <div id="chart-wrapper">
            <div id="chart-container">
                <canvas id="riskProfitChart"></canvas>
            </div>
            <div id="quick-action-buttons" class="quick-buttons-wrapper">
                <div class="quick-view-title">Quick View</div>
                <button class="quick-btn" id="btn-highest-return">Highest Return</button>
                <button class="quick-btn" id="btn-highest-tr">Highest TR</button>
                <button class="quick-btn" id="btn-lowest-risk">Lowest Risk</button>
            </div>
        </div>
        <div id="detailPanel">
            <button class="close-btn" onclick="hideDetailPanel()"></button>
            <div class="detail-header">
                <h3>Portfolio Details</h3>
                <div id="portfolioIndexDisplay" class="index-badge"></div>
            </div>
            <div id="detailContent"></div>
        </div>
        <div id="nextPeriodPreviewPanel" style="display: none; margin-top: 30px; padding: 25px; border: 3px solid #b24ae2; border-radius: 16px; background: #fbfaff; box-shadow: 0 6px 20px rgba(0,0,0,0.15);">
            <h3 style="text-align: center; margin: 0 0 20px 0; font-size: 40px; color: #000000;">
                Sliding Window Test Period
            </h3>
            
            <!-- <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; font-family: 'Times New Roman', serif; font-size: 19px;">
                <div style="min-width: 300px;">
                    <strong>Current Period:</strong><br>
                    <code id="current-url-display" style="word-break: break-all; background:#f0f0f0; padding:8px; border-radius:6px; display:block; margin-top:6px;"></code>
                </div>
                <div style="min-width: 300px;">
                    <strong>Next Period:</strong><br>
                    <code id="next-url-display" style="word-break: break-all; background:#fff0e6; padding:8px; border-radius:6px; display:block; margin-top:6px; color:#d60;"></code>
                </div>
            </div> -->
            
            <div style="width: 100%; aspect-ratio: 16 / 10; max-height: 60vh;background:white; border-radius:12px; overflow:hidden; box-shadow: inset 0 0 10px rgba(0,0,0,0.1);">
                <canvas id="nextPeriodFundChart"></canvas>
            </div>
        </div>
        <!-- 股價顯示區塊 -->
        <div id="stockPriceContainer">
            <h3></h3>
            <div id="stockPriceError"></div>
            </table>
        </div>
        
    </div>
    <script src="js/frontier_FS.js"></script>
</body>

</html>